{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    /* Global Reset & Typography */
    :root {
        --primary-color: #10b981;
        /* Emerald 500 */
        --primary-hover: #059669;
        /* Emerald 600 */
        --secondary-color: #1f2937;
        /* Gray 800 */
        --bg-color: #f3f4f6;
        /* Gray 100 */
        --text-color: #374151;
        /* Gray 700 */
        --card-bg: #ffffff;
    }

    body {
        background-color: var(--bg-color);
        font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    }

    /* HEADER */
    #header {
        background: var(--secondary-color);
        color: #fff;
        padding: 15px 30px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    #branding h1 {
        font-weight: 800;
        letter-spacing: 0.5px;
        color: #fff;
    }

    #branding h1 span {
        color: var(--primary-color);
    }

    #user-tools {
        font-weight: 500;
    }

    /* DASHBOARD KPIS */
    .kpi-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 24px;
        margin: 30px 0;
    }

    .kpi-card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        display: flex;
        align-items: center;
        transition: transform 0.2s;
    }

    .kpi-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    .kpi-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin-right: 16px;
    }

    .kpi-blue {
        background: #eff6ff;
        color: #3b82f6;
    }

    .kpi-green {
        background: #ecfdf5;
        color: #10b981;
    }

    .kpi-yellow {
        background: #fffbeb;
        color: #f59e0b;
    }

    .kpi-red {
        background: #fef2f2;
        color: #ef4444;
    }

    .kpi-content div:first-child {
        color: #6b7280;
        font-size: 0.875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .kpi-content div:last-child {
        color: #111827;
        font-size: 1.875rem;
        font-weight: 800;
        line-height: 1.2;
    }

    /* APP MODULES */
    .module {
        background: var(--card-bg);
        border-radius: 12px;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        overflow: hidden;
        border: none;
    }

    .module caption {
        background: var(--secondary-color);
        padding: 12px 20px;
        font-size: 1.1rem;
        font-weight: 600;
    }

    .module caption a.section {
        color: #fff;
        text-decoration: none;
    }

    .module tr {
        border-bottom: 1px solid #f3f4f6;
    }

    .module td,
    .module th {
        padding: 16px 20px;
        color: var(--text-color);
        font-size: 0.95rem;
    }

    .module th a {
        color: #111827;
        font-weight: 600;
        text-decoration: none;
    }

    .module td a {
        color: var(--secondary-color);
        font-weight: 500;
    }

    .viewlink,
    .addlink,
    .changelink {
        color: var(--primary-color) !important;
        font-weight: 600;
    }

    /* ACTIONS & BUTTONS */
    .button,
    input[type=submit],
    input[type=button] {
        background: var(--primary-color);
        color: white;
        padding: 10px 20px;
        border-radius: 6px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        transition: background 0.2s;
    }

    .button:hover,
    input[type=submit]:hover {
        background: var(--primary-hover);
    }

    /* RECENT ACTIONS SIDEBAR - Hide or Style */
    #content-related {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-top: 30px;
    }

    #content-related h2 {
        background: transparent;
        color: #111827;
        font-size: 1.2rem;
        padding: 0 0 10px 0;
        border-bottom: 2px solid #f3f4f6;
    }
</style>
{% endblock %}

{% block branding %}
<h1 id="site-name"><a href="{% url 'admin:index' %}">Turf<span>Spot</span> Admin</a></h1>
{% endblock %}

{% block content %}
<div class="kpi-container">
    <div class="kpi-card">
        <div class="kpi-icon kpi-blue"><i class="fas fa-users"></i></div>
        <div class="kpi-content">
            <div>Total Users</div>
            <div>{{ kpi_data.total_users }}</div>
        </div>
    </div>
    <div class="kpi-card">
        <div class="kpi-icon kpi-green"><i class="fas fa-futbol"></i></div>
        <div class="kpi-content">
            <div>Active Turfs</div>
            <div>{{ kpi_data.total_turfs }}</div>
        </div>
    </div>
    <div class="kpi-card">
        <div class="kpi-icon kpi-yellow"><i class="fas fa-clock"></i></div>
        <div class="kpi-content">
            <div>Today's Bookings</div>
            <div>{{ kpi_data.today_bookings }}</div>
        </div>
    </div>
    <div class="kpi-card">
        <div class="kpi-icon kpi-red"><i class="fas fa-rupee-sign"></i></div>
        <div class="kpi-content">
            <div>Total Revenue</div>
            <div>{{ kpi_data.total_revenue }}</div>
        </div>
    </div>
    <a href="{% url 'admin:pending_approvals_list' %}" style="text-decoration: none; color: inherit;">
        <div class="kpi-card" style="border: 2px solid #f59e0b; cursor: pointer;">
            <div class="kpi-icon" style="background: #fef3c7; color: #d97706;"><i class="fas fa-hourglass-half"></i>
            </div>
            <div class="kpi-content">
                <div>Pending Approvals</div>
                <div>{{ kpi_data.pending_approvals }}</div>
            </div>
        </div>
    </a>
</div>

{% if pending_owners %}
<div
    style="background: white; border-radius: 12px; padding: 24px; margin: 30px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
    <h2 style="margin: 0 0 20px 0; font-size: 1.5rem; color: #111827; display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-clipboard-check" style="color: #f59e0b;"></i>
        Pending Turf Owner Registrations
    </h2>

    {% for owner in pending_owners %}
    <div
        style="border: 2px solid #fef3c7; border-radius: 12px; padding: 24px; margin-bottom: 24px; background: #fffbeb;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 20px;">
            <div>
                <h3
                    style="margin: 0 0 16px 0; color: #111827; font-size: 1.25rem; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-building" style="color: #10b981;"></i>
                    Business Information
                </h3>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 8px 0; font-weight: 600; color: #6b7280;">Business Name:</td>
                        <td style="padding: 8px 0; color: #111827;">{{ owner.owner_profile.business_name }}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 8px 0; font-weight: 600; color: #6b7280;">Contact Email:</td>
                        <td style="padding: 8px 0; color: #111827;">{{ owner.owner_profile.contact_email }}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 8px 0; font-weight: 600; color: #6b7280;">Phone Number:</td>
                        <td style="padding: 8px 0; color: #111827;">{{ owner.phone_number }}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 8px 0; font-weight: 600; color: #6b7280;">City:</td>
                        <td style="padding: 8px 0; color: #111827;">{{ owner.owner_profile.city }}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 8px 0; font-weight: 600; color: #6b7280;">ZIP Code:</td>
                        <td style="padding: 8px 0; color: #111827;">{{ owner.owner_profile.zip_code }}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px 0; font-weight: 600; color: #6b7280;">Address:</td>
                        <td style="padding: 8px 0; color: #111827;">{{ owner.owner_profile.address }}</td>
                    </tr>
                </table>
            </div>

            {% with turf=owner.turfs.first %}
            {% if turf %}
            <div>
                <h3
                    style="margin: 0 0 16px 0; color: #111827; font-size: 1.25rem; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-futbol" style="color: #3b82f6;"></i>
                    Turf Details
                </h3>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 8px 0; font-weight: 600; color: #6b7280;">Turf Name:</td>
                        <td style="padding: 8px 0; color: #111827;">{{ turf.name }}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 8px 0; font-weight: 600; color: #6b7280;">Description:</td>
                        <td style="padding: 8px 0; color: #111827;">{{ turf.description|truncatewords:20 }}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 8px 0; font-weight: 600; color: #6b7280;">Price/Hour:</td>
                        <td style="padding: 8px 0; color: #111827; font-weight: 700;">â‚¹{{ turf.price_per_hour }}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 8px 0; font-weight: 600; color: #6b7280;">Sports:</td>
                        <td style="padding: 8px 0;">
                            {% for sport in turf.sports.all %}
                            <span
                                style="display: inline-block; background: #dbeafe; color: #1e40af; padding: 4px 12px; border-radius: 12px; font-size: 0.875rem; margin: 2px;">
                                {{ sport.name }}
                            </span>
                            {% endfor %}
                        </td>
                    </tr>
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 8px 0; font-weight: 600; color: #6b7280;">Location:</td>
                        <td style="padding: 8px 0; color: #111827;">
                            {% if turf.latitude and turf.longitude %}
                            <a href="https://www.google.com/maps?q={{ turf.latitude }},{{ turf.longitude }}"
                                target="_blank" style="color: #3b82f6; text-decoration: none;">
                                <i class="fas fa-map-marker-alt"></i> {{ turf.latitude|floatformat:4 }}, {{
                                turf.longitude|floatformat:4 }}
                            </a>
                            {% else %}
                            <span style="color: #ef4444;">Not provided</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 8px 0; font-weight: 600; color: #6b7280;">Submitted:</td>
                        <td style="padding: 8px 0; color: #111827;">{{ owner.owner_application_date|date:"M d, Y H:i" }}
                        </td>
                    </tr>
                </table>
            </div>
            {% endif %}
            {% endwith %}
        </div>

        {% with turf=owner.turfs.first %}
        {% if turf.images.all %}
        <div style="margin: 20px 0;">
            <h4
                style="margin: 0 0 12px 0; color: #111827; font-size: 1rem; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-images" style="color: #8b5cf6;"></i>
                Uploaded Images ({{ turf.images.count }})
            </h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px;">
                {% for image in turf.images.all %}
                <div
                    style="position: relative; border-radius: 8px; overflow: hidden; aspect-ratio: 1; background: #f3f4f6;">
                    <img src="{{ image.image.url }}" alt="Turf Image"
                        style="width: 100%; height: 100%; object-fit: cover;">
                    {% if image.is_cover %}
                    <span
                        style="position: absolute; top: 8px; right: 8px; background: #10b981; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">
                        COVER
                    </span>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if turf.videos.all %}
        <div style="margin: 20px 0;">
            <h4
                style="margin: 0 0 12px 0; color: #111827; font-size: 1rem; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-video" style="color: #ef4444;"></i>
                Promotional Video
            </h4>
            <video controls style="max-width: 400px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <source src="{{ turf.videos.first.video.url }}" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
        {% endif %}
        {% endwith %}

        <div
            style="margin-top: 24px; padding-top: 20px; border-top: 2px solid #fde68a; display: flex; gap: 12px; justify-content: flex-end;">
            <form method="post" action="{% url 'admin:users_customuser_changelist' %}" style="display: inline;">
                {% csrf_token %}
                <input type="hidden" name="action" value="approve_owners">
                <input type="hidden" name="_selected_action" value="{{ owner.pk }}">
                <button type="submit"
                    style="background: #10b981; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; transition: background 0.2s;">
                    <i class="fas fa-check-circle"></i>
                    Approve Owner
                </button>
            </form>
            <form method="post" action="{% url 'admin:users_customuser_delete' owner.pk %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit"
                    onclick="return confirm('Are you sure you want to reject this application? This will delete the user and all associated data.');"
                    style="background: #ef4444; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; transition: background 0.2s;">
                    <i class="fas fa-times-circle"></i>
                    Reject Application
                </button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

{{ block.super }}

{% endblock %}